var tn=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var bc=tn((U,W)=>{/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const nr=Symbol("Comlink.proxy"),rn=Symbol("Comlink.endpoint"),nn=Symbol("Comlink.releaseProxy"),ze=Symbol("Comlink.finalizer"),Ie=Symbol("Comlink.thrown"),sr=t=>typeof t=="object"&&t!==null||typeof t=="function",sn={canHandle:t=>sr(t)&&t[nr],serialize(t){const{port1:e,port2:r}=new MessageChannel;return ft(t,e),[r,[r]]},deserialize(t){return t.start(),un(t)}},an={canHandle:t=>sr(t)&&Ie in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},ir=new Map([["proxy",sn],["throw",an]]);function on(t,e){for(const r of t)if(e===r||r==="*"||r instanceof RegExp&&r.test(e))return!0;return!1}function ft(t,e=globalThis,r=["*"]){e.addEventListener("message",function n(s){if(!s||!s.data)return;if(!on(r,s.origin)){console.warn(`Invalid origin '${s.origin}' for comlink proxy`);return}const{id:i,type:a,path:c}=Object.assign({path:[]},s.data),u=(s.data.argumentList||[]).map(ne);let o;try{const l=c.slice(0,-1).reduce((b,d)=>b[d],t),y=c.reduce((b,d)=>b[d],t);switch(a){case"GET":o=y;break;case"SET":l[c.slice(-1)[0]]=ne(s.data.value),o=!0;break;case"APPLY":o=y.apply(l,u);break;case"CONSTRUCT":{const b=new y(...u);o=hn(b)}break;case"ENDPOINT":{const{port1:b,port2:d}=new MessageChannel;ft(t,d),o=ur(b,[b])}break;case"RELEASE":o=void 0;break;default:return}}catch(l){o={value:l,[Ie]:0}}Promise.resolve(o).catch(l=>({value:l,[Ie]:0})).then(l=>{const[y,b]=Fe(l);e.postMessage(Object.assign(Object.assign({},y),{id:i}),b),a==="RELEASE"&&(e.removeEventListener("message",n),ar(e),ze in t&&typeof t[ze]=="function"&&t[ze]())}).catch(l=>{const[y,b]=Fe({value:new TypeError("Unserializable return value"),[Ie]:0});e.postMessage(Object.assign(Object.assign({},y),{id:i}),b)})}),e.start&&e.start()}function cn(t){return t.constructor.name==="MessagePort"}function ar(t){cn(t)&&t.close()}function un(t,e){const r=new Map;return t.addEventListener("message",function(s){const{data:i}=s;if(!i||!i.id)return;const a=r.get(i.id);if(a)try{a(i)}finally{r.delete(i.id)}}),et(t,r,[],e)}function De(t){if(t)throw new Error("Proxy has been released and is not useable")}function or(t){return de(t,new Map,{type:"RELEASE"}).then(()=>{ar(t)})}const xe=new WeakMap,Be="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(xe.get(t)||0)-1;xe.set(t,e),e===0&&or(t)});function ln(t,e){const r=(xe.get(e)||0)+1;xe.set(e,r),Be&&Be.register(t,e,t)}function fn(t){Be&&Be.unregister(t)}function et(t,e,r=[],n=function(){}){let s=!1;const i=new Proxy(n,{get(a,c){if(De(s),c===nn)return()=>{fn(i),or(t),e.clear(),s=!0};if(c==="then"){if(r.length===0)return{then:()=>i};const u=de(t,e,{type:"GET",path:r.map(o=>o.toString())}).then(ne);return u.then.bind(u)}return et(t,e,[...r,c])},set(a,c,u){De(s);const[o,l]=Fe(u);return de(t,e,{type:"SET",path:[...r,c].map(y=>y.toString()),value:o},l).then(ne)},apply(a,c,u){De(s);const o=r[r.length-1];if(o===rn)return de(t,e,{type:"ENDPOINT"}).then(ne);if(o==="bind")return et(t,e,r.slice(0,-1));const[l,y]=vt(u);return de(t,e,{type:"APPLY",path:r.map(b=>b.toString()),argumentList:l},y).then(ne)},construct(a,c){De(s);const[u,o]=vt(c);return de(t,e,{type:"CONSTRUCT",path:r.map(l=>l.toString()),argumentList:u},o).then(ne)}});return ln(i,t),i}function dn(t){return Array.prototype.concat.apply([],t)}function vt(t){const e=t.map(Fe);return[e.map(r=>r[0]),dn(e.map(r=>r[1]))]}const cr=new WeakMap;function ur(t,e){return cr.set(t,e),t}function hn(t){return Object.assign(t,{[nr]:!0})}function Fe(t){for(const[e,r]of ir)if(r.canHandle(t)){const[n,s]=r.serialize(t);return[{type:"HANDLER",name:e,value:n},s]}return[{type:"RAW",value:t},cr.get(t)||[]]}function ne(t){switch(t.type){case"HANDLER":return ir.get(t.name).deserialize(t.value);case"RAW":return t.value}}function de(t,e,r,n){return new Promise(s=>{const i=pn();e.set(i,s),t.start&&t.start(),t.postMessage(Object.assign({id:i},r),n)})}function pn(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}const tt=(t,e)=>e.some(r=>t instanceof r);let _t,$t;function yn(){return _t||(_t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function gn(){return $t||($t=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const rt=new WeakMap,Ge=new WeakMap,He=new WeakMap;function mn(t){const e=new Promise((r,n)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",a)},i=()=>{r(ee(t.result)),s()},a=()=>{n(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",a)});return He.set(e,t),e}function bn(t){if(rt.has(t))return;const e=new Promise((r,n)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",a),t.removeEventListener("abort",a)},i=()=>{r(),s()},a=()=>{n(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",a),t.addEventListener("abort",a)});rt.set(t,e)}let nt={get(t,e,r){if(t instanceof IDBTransaction){if(e==="done")return rt.get(t);if(e==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return ee(t[e])},set(t,e,r){return t[e]=r,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function lr(t){nt=t(nt)}function wn(t){return gn().includes(t)?function(...e){return t.apply(st(this),e),ee(this.request)}:function(...e){return ee(t.apply(st(this),e))}}function vn(t){return typeof t=="function"?wn(t):(t instanceof IDBTransaction&&bn(t),tt(t,yn())?new Proxy(t,nt):t)}function ee(t){if(t instanceof IDBRequest)return mn(t);if(Ge.has(t))return Ge.get(t);const e=vn(t);return e!==t&&(Ge.set(t,e),He.set(e,t)),e}const st=t=>He.get(t);function fr(t,e,{blocked:r,upgrade:n,blocking:s,terminated:i}={}){const a=indexedDB.open(t,e),c=ee(a);return n&&a.addEventListener("upgradeneeded",u=>{n(ee(a.result),u.oldVersion,u.newVersion,ee(a.transaction),u)}),r&&a.addEventListener("blocked",u=>r(u.oldVersion,u.newVersion,u)),c.then(u=>{i&&u.addEventListener("close",()=>i()),s&&u.addEventListener("versionchange",o=>s(o.oldVersion,o.newVersion,o))}).catch(()=>{}),c}function dr(t,{blocked:e}={}){const r=indexedDB.deleteDatabase(t);return e&&r.addEventListener("blocked",n=>e(n.oldVersion,n)),ee(r).then(()=>{})}const _n=["get","getKey","getAll","getAllKeys","count"],$n=["put","add","delete","clear"],Ke=new Map;function Mt(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Ke.get(e))return Ke.get(e);const r=e.replace(/FromIndex$/,""),n=e!==r,s=$n.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(s||_n.includes(r)))return;const i=async function(a,...c){const u=this.transaction(a,s?"readwrite":"readonly");let o=u.store;return n&&(o=o.index(c.shift())),(await Promise.all([o[r](...c),s&&u.done]))[0]};return Ke.set(e,i),i}lr(t=>({...t,get:(e,r,n)=>Mt(e,r)||t.get(e,r,n),has:(e,r)=>!!Mt(e,r)||t.has(e,r)}));const Mn=["continue","continuePrimaryKey","advance"],St={},it=new WeakMap,hr=new WeakMap,Sn={get(t,e){if(!Mn.includes(e))return t[e];let r=St[e];return r||(r=St[e]=function(...n){it.set(this,hr.get(this)[e](...n))}),r}};async function*jn(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;e=e;const r=new Proxy(e,Sn);for(hr.set(r,e),He.set(r,st(e));e;)yield r,e=await(it.get(r)||e.continue()),it.delete(r)}function jt(t,e){return e===Symbol.asyncIterator&&tt(t,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&tt(t,[IDBIndex,IDBObjectStore])}lr(t=>({...t,get(e,r,n){return jt(e,r)?jn:t.get(e,r,n)},has(e,r){return jt(e,r)||t.has(e,r)}}));const An="https://cdn.jsdelivr.net/npm/jieba-wasm@2.4.0/pkg/web/jieba_rs_wasm_bg.wasm";let Oe;const Tn=new Set(["的","了","和","是","就","都","而","及","与","在","这","那","有","我","你","他","她","它","们","个","上","下","之","用","等","来","去","说","着","让","到","为","把","被","或","且","一个","没有","我们","你们","他们","这里","那里","但是","因为","所以","，","。","！","？","：","；","“","”","（","）","、",`
`," "]),Dn=["alipay","wechat","yy"],At=t=>Dn.reduce((e,r)=>e?.replaceAll(r," "),t);async function On(){return Oe||(console.log("正在动态加载 jieba-wasm..."),Oe=(async()=>{const t=await import("https://cdn.jsdelivr.net/npm/jieba-wasm@2.4.0/pkg/web/jieba_rs_wasm.js");return await t.default(An),t})(),Oe)}async function En(t,e=150){const r=await On(),n=Array.isArray(t)?t.flatMap(a=>r.cut(At(a),!0)):r.cut(At(t),!0),s=new Map;return n.forEach(a=>{a.length>1&&!Tn.has(a)&&!/^\s+$/.test(a)&&s.set(a,(s.get(a)||0)+1)}),Array.from(s.entries()).sort((a,c)=>c[1]-a[1]).slice(0,e)}function Tt(t,e,r){for(const n of Object.keys(t)){const s=t[n];for(const i of Object.keys(s))s[i]=(s[i]||0)*e,s[i]<r&&delete s[i];Object.keys(s).length===0&&delete t[n]}}function Dt(t,e,r){for(const n of Object.keys(t)){const s=t[n];for(const i of Object.keys(s))s[i]=(s[i]||0)*e,s[i]<r&&delete s[i];Object.keys(s).length===0&&delete t[n]}}const pr="cent_predict",Le="models",In=1;function yr(){return fr(pr,In,{upgrade(t){t.objectStoreNames.contains(Le)||t.createObjectStore(Le)}})}async function gr(t){const e=await yr(),r=await e.get(Le,t);return e.close(),r??null}async function Cn(t,e){const r=await yr(),n={...e,meta:{updatedAt:Date.now(),...e.meta??{}}};await r.put(Le,n,t),r.close()}function at(t){return`hour_${new Date(t).getHours()}`}async function mr(t){const e=await gr(t);return{meta:e?.meta??{},categoryModel:e?.categoryModel??{},commentModel:e?.commentModel??{}}}const Rn=async(t,e,r,n)=>{const s=await mr(t),i=s.categoryModel,a=s.commentModel,c=Date.now(),u=30,o=.01,l=u*24*3600*1e3,y=Math.LN2/l,b=(s.meta&&s.meta.updatedAt)??(r&&r.timeRange?r.timeRange[1]:void 0)??c,d=Math.max(0,c-b),_=Math.exp(-y*d);d>0&&_<1&&(Tt(i,_,o),Dt(a,_,o));for(const P of e){const{time:F,categoryId:j,comment:z}=P,G=at(F),R=Math.max(0,c-F),N=Math.exp(-y*R);if(i[G]=i[G]||{},i[G][j]=(i[G][j]||0)+N,z){a[j]=a[j]||{};try{(await En(z,150)).forEach(([H,K])=>{if(!H||H.length<=1)return;const M=K*N;a[j][H]=(a[j][H]||0)+M})}catch(q){console.error("incrementalLearn: processText error",q)}}}Tt(i,1,o),Dt(a,1,o);const E={meta:s.meta,categoryModel:i,commentModel:a};r&&(E.meta={...E.meta,...r}),await Cn(t,E)},Pn=async t=>{const e=await gr(t);if(e?.meta?.timeRange)return{timeRange:e.meta.timeRange}},Nn=async(t,e,r,n=3)=>{const s=await mr(t);if(e==="category"){const l=at(r),y=s.categoryModel[l];return y?Object.entries(y).sort(([,d],[,_])=>_-d).map(([d])=>d).slice(0,n):[]}const i=at(r),a=s.categoryModel[i];if(!a)return[];const c=Object.entries(a).sort(([,l],[,y])=>y-l).map(([l])=>l)[0];if(!c)return[];const u=s.commentModel[c];return u?Object.entries(u).sort(([,l],[,y])=>y-l).map(([l])=>l).slice(0,n):[]},xn=async()=>{await dr(pr)},x=[];for(let t=0;t<256;++t)x.push((t+256).toString(16).slice(1));function Bn(t,e=0){return(x[t[e+0]]+x[t[e+1]]+x[t[e+2]]+x[t[e+3]]+"-"+x[t[e+4]]+x[t[e+5]]+"-"+x[t[e+6]]+x[t[e+7]]+"-"+x[t[e+8]]+x[t[e+9]]+"-"+x[t[e+10]]+x[t[e+11]]+x[t[e+12]]+x[t[e+13]]+x[t[e+14]]+x[t[e+15]]).toLowerCase()}let qe;const Fn=new Uint8Array(16);function Ln(){if(!qe){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");qe=crypto.getRandomValues.bind(crypto)}return qe(Fn)}const kn=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var Ot={randomUUID:kn};function Vn(t,e,r){if(Ot.randomUUID&&!t)return Ot.randomUUID();t=t||{};const n=t.random??t.rng?.()??Ln();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=n[6]&15|64,n[8]=n[8]&63|128,Bn(n)}function Hn(t){var e;const r=/^\/(.*)\/([gimyu]*)$/.exec(t.toString());if(!r)throw new Error("Invalid RegExp");return new RegExp((e=r[1])!==null&&e!==void 0?e:"",r[2])}function ke(t){if(typeof t!="object")return t;if(t===null)return null;if(Array.isArray(t))return t.map(ke);if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp)return Hn(t);const e={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=ke(t[r]));return e}function Un(t,e){if(t.length===0)throw new Error("Expected a non-empty array")}const Wn=t=>t[t.length-1];class dt{setResult(e){return this.result=e,this.hasResult=!0,this}exit(){return this.exiting=!0,this}push(e,r){return e.parent=this,typeof r<"u"&&(e.childName=r),e.root=this.root||this,e.options=e.options||this.options,this.children?(Un(this.children),Wn(this.children).next=e,this.children.push(e)):(this.children=[e],this.nextAfterChildren=this.next||null,this.next=e),e.next=this,this}}class se extends dt{constructor(e,r){super(),this.left=e,this.right=r,this.pipe="diff"}prepareDeltaResult(e){var r,n,s,i;if(typeof e=="object"&&(!((r=this.options)===null||r===void 0)&&r.omitRemovedValues&&Array.isArray(e)&&e.length>1&&(e.length===2||e[2]===0||e[2]===3)&&(e[0]=0),!((n=this.options)===null||n===void 0)&&n.cloneDiffValues)){const a=typeof((s=this.options)===null||s===void 0?void 0:s.cloneDiffValues)=="function"?(i=this.options)===null||i===void 0?void 0:i.cloneDiffValues:ke;typeof e[0]=="object"&&(e[0]=a(e[0])),typeof e[1]=="object"&&(e[1]=a(e[1]))}return e}setResult(e){return this.prepareDeltaResult(e),super.setResult(e)}}class ht extends dt{constructor(e,r){super(),this.left=e,this.delta=r,this.pipe="patch"}}class pt extends dt{constructor(e){super(),this.delta=e,this.pipe="reverse"}}class Je{constructor(e){this.name=e,this.filters=[]}process(e){if(!this.processor)throw new Error("add this pipe to a processor before using it");const r=this.debug,n=this.filters.length,s=e;for(let i=0;i<n;i++){const a=this.filters[i];if(a&&(r&&this.log(`filter: ${a.filterName}`),a(s),typeof s=="object"&&s.exiting)){s.exiting=!1;break}}!s.next&&this.resultCheck&&this.resultCheck(s)}log(e){console.log(`[jsondiffpatch] ${this.name} pipe, ${e}`)}append(...e){return this.filters.push(...e),this}prepend(...e){return this.filters.unshift(...e),this}indexOf(e){if(!e)throw new Error("a filter name is required");for(let r=0;r<this.filters.length;r++){const n=this.filters[r];if(n?.filterName===e)return r}throw new Error(`filter not found: ${e}`)}list(){return this.filters.map(e=>e.filterName)}after(e,...r){const n=this.indexOf(e);return this.filters.splice(n+1,0,...r),this}before(e,...r){const n=this.indexOf(e);return this.filters.splice(n,0,...r),this}replace(e,...r){const n=this.indexOf(e);return this.filters.splice(n,1,...r),this}remove(e){const r=this.indexOf(e);return this.filters.splice(r,1),this}clear(){return this.filters.length=0,this}shouldHaveResult(e){return e===!1?(this.resultCheck=null,this):this.resultCheck?this:(this.resultCheck=r=>{if(!r.hasResult){console.log(r);const n=new Error(`${this.name} failed`);throw n.noResult=!0,n}},this)}}class Yn{constructor(e){this.selfOptions=e||{},this.pipes={}}options(e){return e&&(this.selfOptions=e),this.selfOptions}pipe(e,r){let n=r;if(typeof e=="string"){if(typeof n>"u")return this.pipes[e];this.pipes[e]=n}if(e&&e.name){if(n=e,n.processor===this)return n;this.pipes[n.name]=n}if(!n)throw new Error(`pipe is not defined: ${e}`);return n.processor=this,n}process(e,r){let n=e;n.options=this.options();let s=r||e.pipe||"default",i;for(;s;)typeof n.nextAfterChildren<"u"&&(n.next=n.nextAfterChildren,n.nextAfterChildren=null),typeof s=="string"&&(s=this.pipe(s)),s.process(n),i=s,s=null,n&&n.next&&(n=n.next,s=n.pipe||i);return n.hasResult?n.result:void 0}}const zn=(t,e,r,n)=>t[r]===e[n],Gn=(t,e,r,n)=>{var s,i,a;const c=t.length,u=e.length;let o,l;const y=new Array(c+1);for(o=0;o<c+1;o++){const b=new Array(u+1);for(l=0;l<u+1;l++)b[l]=0;y[o]=b}for(y.match=r,o=1;o<c+1;o++){const b=y[o];if(b===void 0)throw new Error("LCS matrix row is undefined");const d=y[o-1];if(d===void 0)throw new Error("LCS matrix row is undefined");for(l=1;l<u+1;l++)r(t,e,o-1,l-1,n)?b[l]=((s=d[l-1])!==null&&s!==void 0?s:0)+1:b[l]=Math.max((i=d[l])!==null&&i!==void 0?i:0,(a=b[l-1])!==null&&a!==void 0?a:0)}return y},Kn=(t,e,r,n)=>{let s=e.length,i=r.length;const a={sequence:[],indices1:[],indices2:[]};for(;s!==0&&i!==0;){if(t.match===void 0)throw new Error("LCS matrix match function is undefined");if(t.match(e,r,s-1,i-1,n))a.sequence.unshift(e[s-1]),a.indices1.unshift(s-1),a.indices2.unshift(i-1),--s,--i;else{const u=t[s];if(u===void 0)throw new Error("LCS matrix row is undefined");const o=u[i-1];if(o===void 0)throw new Error("LCS matrix value is undefined");const l=t[s-1];if(l===void 0)throw new Error("LCS matrix row is undefined");const y=l[i];if(y===void 0)throw new Error("LCS matrix value is undefined");o>y?--i:--s}}return a},qn=(t,e,r,n)=>{const s=n||{},i=Gn(t,e,r||zn,s);return Kn(i,t,e,s)};var Jn={get:qn};const ie=3;function Xn(t,e,r,n){for(let s=0;s<r;s++){const i=t[s];for(let a=0;a<n;a++){const c=e[a];if(s!==a&&i===c)return!0}}return!1}function Ee(t,e,r,n,s){const i=t[r],a=e[n];if(i===a)return!0;if(typeof i!="object"||typeof a!="object")return!1;const c=s.objectHash;if(!c)return s.matchByPosition&&r===n;s.hashCache1=s.hashCache1||[];let u=s.hashCache1[r];if(typeof u>"u"&&(s.hashCache1[r]=u=c(i,r)),typeof u>"u")return!1;s.hashCache2=s.hashCache2||[];let o=s.hashCache2[n];return typeof o>"u"&&(s.hashCache2[n]=o=c(a,n)),typeof o>"u"?!1:u===o}const br=function(e){var r,n,s,i,a;if(!e.leftIsArray)return;const c={objectHash:(r=e.options)===null||r===void 0?void 0:r.objectHash,matchByPosition:(n=e.options)===null||n===void 0?void 0:n.matchByPosition};let u=0,o=0,l,y,b;const d=e.left,_=e.right,E=d.length,P=_.length;let F;for(E>0&&P>0&&!c.objectHash&&typeof c.matchByPosition!="boolean"&&(c.matchByPosition=!Xn(d,_,E,P));u<E&&u<P&&Ee(d,_,u,u,c);)l=u,F=new se(d[l],_[l]),e.push(F,l),u++;for(;o+u<E&&o+u<P&&Ee(d,_,E-1-o,P-1-o,c);)y=E-1-o,b=P-1-o,F=new se(d[y],_[b]),e.push(F,b),o++;let j;if(u+o===E){if(E===P){e.setResult(void 0).exit();return}for(j=j||{_t:"a"},l=u;l<P-o;l++)j[l]=[_[l]],e.prepareDeltaResult(j[l]);e.setResult(j).exit();return}if(u+o===P){for(j=j||{_t:"a"},l=u;l<E-o;l++){const M=`_${l}`;j[M]=[d[l],0,0],e.prepareDeltaResult(j[M])}e.setResult(j).exit();return}c.hashCache1=void 0,c.hashCache2=void 0;const z=d.slice(u,E-o),G=_.slice(u,P-o),R=Jn.get(z,G,Ee,c),N=[];for(j=j||{_t:"a"},l=u;l<E-o;l++)if(R.indices1.indexOf(l-u)<0){const M=`_${l}`;j[M]=[d[l],0,0],e.prepareDeltaResult(j[M]),N.push(l)}let q=!0;!((s=e.options)===null||s===void 0)&&s.arrays&&e.options.arrays.detectMove===!1&&(q=!1);let H=!1;!((a=(i=e.options)===null||i===void 0?void 0:i.arrays)===null||a===void 0)&&a.includeValueOnMove&&(H=!0);const K=N.length;for(l=u;l<P-o;l++){const M=R.indices2.indexOf(l-u);if(M<0){let $=!1;if(q&&K>0)for(let L=0;L<K;L++){y=N[L];const Y=y===void 0?void 0:j[`_${y}`];if(y!==void 0&&Y&&Ee(z,G,y-u,l-u,c)){Y.splice(1,2,l,ie),Y.splice(1,2,l,ie),H||(Y[0]=""),b=l,F=new se(d[y],_[b]),e.push(F,b),N.splice(L,1),$=!0;break}}$||(j[l]=[_[l]],e.prepareDeltaResult(j[l]))}else{if(R.indices1[M]===void 0)throw new Error(`Invalid indexOnArray2: ${M}, seq.indices1: ${R.indices1}`);if(y=R.indices1[M]+u,R.indices2[M]===void 0)throw new Error(`Invalid indexOnArray2: ${M}, seq.indices2: ${R.indices2}`);b=R.indices2[M]+u,F=new se(d[y],_[b]),e.push(F,b)}}e.setResult(j).exit()};br.filterName="arrays";const Et={numerically(t,e){return t-e},numericallyBy(t){return(e,r)=>e[t]-r[t]}},wr=function(e){var r;if(!e.nested)return;const n=e.delta;if(n._t!=="a")return;let s,i;const a=n,c=e.left;let u=[],o=[];const l=[];for(s in a)if(s!=="_t")if(s[0]==="_"){const d=s;if(a[d]!==void 0&&(a[d][2]===0||a[d][2]===ie))u.push(Number.parseInt(s.slice(1),10));else throw new Error(`only removal or move can be applied at original array indices, invalid diff type: ${(r=a[d])===null||r===void 0?void 0:r[2]}`)}else{const d=s;a[d].length===1?o.push({index:Number.parseInt(d,10),value:a[d][0]}):l.push({index:Number.parseInt(d,10),delta:a[d]})}for(u=u.sort(Et.numerically),s=u.length-1;s>=0;s--){if(i=u[s],i===void 0)continue;const d=a[`_${i}`],_=c.splice(i,1)[0];d?.[2]===ie&&o.push({index:d[1],value:_})}o=o.sort(Et.numericallyBy("index"));const y=o.length;for(s=0;s<y;s++){const d=o[s];d!==void 0&&c.splice(d.index,0,d.value)}const b=l.length;if(b>0)for(s=0;s<b;s++){const d=l[s];if(d===void 0)continue;const _=new ht(c[d.index],d.delta);e.push(_,d.index)}if(!e.children){e.setResult(c).exit();return}e.exit()};wr.filterName="arrays";const vr=function(e){if(!e||!e.children||e.delta._t!=="a")return;const n=e.left,s=e.children.length;for(let i=0;i<s;i++){const a=e.children[i];if(a===void 0)continue;const c=a.childName;n[c]=a.result}e.setResult(n).exit()};vr.filterName="arraysCollectChildren";const _r=function(e){if(!e.nested){const s=e.delta;if(s[2]===ie){const i=s;e.newName=`_${i[1]}`,e.setResult([i[0],Number.parseInt(e.childName.substring(1),10),ie]).exit()}return}const r=e.delta;if(r._t!=="a")return;const n=r;for(const s in n){if(s==="_t")continue;const i=new pt(n[s]);e.push(i,s)}e.exit()};_r.filterName="arrays";const Zn=(t,e,r)=>{if(typeof e=="string"&&e[0]==="_")return Number.parseInt(e.substring(1),10);if(Array.isArray(r)&&r[2]===0)return`_${e}`;let n=+e;for(const s in t){const i=t[s];if(Array.isArray(i))if(i[2]===ie){const a=Number.parseInt(s.substring(1),10),c=i[1];if(c===+e)return a;a<=n&&c>n?n++:a>=n&&c<n&&n--}else i[2]===0?Number.parseInt(s.substring(1),10)<=n&&n++:i.length===1&&Number.parseInt(s,10)<=n&&n--}return n},$r=t=>{if(!t||!t.children)return;const e=t.delta;if(e._t!=="a")return;const r=e,n=t.children.length,s={_t:"a"};for(let i=0;i<n;i++){const a=t.children[i];if(a===void 0)continue;let c=a.newName;if(typeof c>"u"){if(a.childName===void 0)throw new Error("child.childName is undefined");c=Zn(r,a.childName,a.result)}s[c]!==a.result&&(s[c]=a.result)}t.setResult(s).exit()};$r.filterName="arraysCollectChildren";const Mr=function(e){e.left instanceof Date?(e.right instanceof Date?e.left.getTime()!==e.right.getTime()?e.setResult([e.left,e.right]):e.setResult(void 0):e.setResult([e.left,e.right]),e.exit()):e.right instanceof Date&&e.setResult([e.left,e.right]).exit()};Mr.filterName="dates";const Sr=t=>{if(!t||!t.children)return;const e=t.children.length;let r=t.result;for(let n=0;n<e;n++){const s=t.children[n];if(s!==void 0&&!(typeof s.result>"u")){if(r=r||{},s.childName===void 0)throw new Error("diff child.childName is undefined");r[s.childName]=s.result}}r&&t.leftIsArray&&(r._t="a"),t.setResult(r).exit()};Sr.filterName="collectChildren";const jr=t=>{var e;if(t.leftIsArray||t.leftType!=="object")return;const r=t.left,n=t.right,s=(e=t.options)===null||e===void 0?void 0:e.propertyFilter;for(const i in r){if(!Object.prototype.hasOwnProperty.call(r,i)||s&&!s(i,t))continue;const a=new se(r[i],n[i]);t.push(a,i)}for(const i in n)if(Object.prototype.hasOwnProperty.call(n,i)&&!(s&&!s(i,t))&&typeof r[i]>"u"){const a=new se(void 0,n[i]);t.push(a,i)}if(!t.children||t.children.length===0){t.setResult(void 0).exit();return}t.exit()};jr.filterName="objects";const Ar=function(e){if(!e.nested)return;const r=e.delta;if(r._t)return;const n=r;for(const s in n){const i=new ht(e.left[s],n[s]);e.push(i,s)}e.exit()};Ar.filterName="objects";const Tr=function(e){if(!e||!e.children||e.delta._t)return;const n=e.left,s=e.children.length;for(let i=0;i<s;i++){const a=e.children[i];if(a===void 0)continue;const c=a.childName;Object.prototype.hasOwnProperty.call(e.left,c)&&a.result===void 0?delete n[c]:n[c]!==a.result&&(n[c]=a.result)}e.setResult(n).exit()};Tr.filterName="collectChildren";const Dr=function(e){if(!e.nested||e.delta._t)return;const n=e.delta;for(const s in n){const i=new pt(n[s]);e.push(i,s)}e.exit()};Dr.filterName="objects";const Or=t=>{if(!t||!t.children||t.delta._t)return;const r=t.children.length,n={};for(let s=0;s<r;s++){const i=t.children[s];if(i===void 0)continue;const a=i.childName;n[a]!==i.result&&(n[a]=i.result)}t.setResult(n).exit()};Or.filterName="collectChildren";const Ve=2,Qn=60;let Xe=null;function Er(t,e){var r;if(!Xe){let n;if(!((r=t?.textDiff)===null||r===void 0)&&r.diffMatchPatch)n=new t.textDiff.diffMatchPatch;else{if(!e)return null;const s=new Error("The diff-match-patch library was not provided. Pass the library in through the options or use the `jsondiffpatch/with-text-diffs` entry-point.");throw s.diff_match_patch_not_found=!0,s}Xe={diff:(s,i)=>n.patch_toText(n.patch_make(s,i)),patch:(s,i)=>{const a=n.patch_apply(n.patch_fromText(i),s);for(const c of a[1])if(!c){const u=new Error("text patch failed");throw u.textPatchFailed=!0,u}return a[0]}}}return Xe}const Ir=function(e){var r,n;if(e.leftType!=="string")return;const s=e.left,i=e.right,a=((n=(r=e.options)===null||r===void 0?void 0:r.textDiff)===null||n===void 0?void 0:n.minLength)||Qn;if(s.length<a||i.length<a){e.setResult([s,i]).exit();return}const c=Er(e.options);if(!c){e.setResult([s,i]).exit();return}const u=c.diff;e.setResult([u(s,i),0,Ve]).exit()};Ir.filterName="texts";const Cr=function(e){if(e.nested)return;const r=e.delta;if(r[2]!==Ve)return;const n=r,s=Er(e.options,!0).patch;e.setResult(s(e.left,n[0])).exit()};Cr.filterName="texts";const es=t=>{var e,r,n;const s=/^@@ +-(\d+),(\d+) +\+(\d+),(\d+) +@@$/,i=t.split(`
`);for(let a=0;a<i.length;a++){const c=i[a];if(c===void 0)continue;const u=c.slice(0,1);if(u==="@"){const o=s.exec(c);if(o!==null){const l=a;i[l]=`@@ -${o[3]},${o[4]} +${o[1]},${o[2]} @@`}}else if(u==="+"){if(i[a]=`-${(e=i[a])===null||e===void 0?void 0:e.slice(1)}`,((r=i[a-1])===null||r===void 0?void 0:r.slice(0,1))==="+"){const o=i[a];i[a]=i[a-1],i[a-1]=o}}else u==="-"&&(i[a]=`+${(n=i[a])===null||n===void 0?void 0:n.slice(1)}`)}return i.join(`
`)},Rr=function(e){if(e.nested)return;const r=e.delta;if(r[2]!==Ve)return;const n=r;e.setResult([es(n[0]),0,Ve]).exit()};Rr.filterName="texts";const Pr=function(e){if(e.left===e.right){e.setResult(void 0).exit();return}if(typeof e.left>"u"){if(typeof e.right=="function")throw new Error("functions are not supported");e.setResult([e.right]).exit();return}if(typeof e.right>"u"){e.setResult([e.left,0,0]).exit();return}if(typeof e.left=="function"||typeof e.right=="function")throw new Error("functions are not supported");if(e.leftType=e.left===null?"null":typeof e.left,e.rightType=e.right===null?"null":typeof e.right,e.leftType!==e.rightType){e.setResult([e.left,e.right]).exit();return}if(e.leftType==="boolean"||e.leftType==="number"){e.setResult([e.left,e.right]).exit();return}if(e.leftType==="object"&&(e.leftIsArray=Array.isArray(e.left)),e.rightType==="object"&&(e.rightIsArray=Array.isArray(e.right)),e.leftIsArray!==e.rightIsArray){e.setResult([e.left,e.right]).exit();return}e.left instanceof RegExp&&(e.right instanceof RegExp?e.setResult([e.left.toString(),e.right.toString()]).exit():e.setResult([e.left,e.right]).exit())};Pr.filterName="trivial";const Nr=function(e){if(typeof e.delta>"u"){e.setResult(e.left).exit();return}if(e.nested=!Array.isArray(e.delta),e.nested)return;const r=e.delta;if(r.length===1){e.setResult(r[0]).exit();return}if(r.length===2){if(e.left instanceof RegExp){const n=/^\/(.*)\/([gimyu]+)$/.exec(r[1]);if(n?.[1]){e.setResult(new RegExp(n[1],n[2])).exit();return}}e.setResult(r[1]).exit();return}r.length===3&&r[2]===0&&e.setResult(void 0).exit()};Nr.filterName="trivial";const xr=function(e){if(typeof e.delta>"u"){e.setResult(e.delta).exit();return}if(e.nested=!Array.isArray(e.delta),e.nested)return;const r=e.delta;if(r.length===1){e.setResult([r[0],0,0]).exit();return}if(r.length===2){e.setResult([r[1],r[0]]).exit();return}r.length===3&&r[2]===0&&e.setResult([r[0]]).exit()};xr.filterName="trivial";class ts{constructor(e){this.processor=new Yn(e),this.processor.pipe(new Je("diff").append(Sr,Pr,Mr,Ir,jr,br).shouldHaveResult()),this.processor.pipe(new Je("patch").append(Tr,vr,Nr,Cr,Ar,wr).shouldHaveResult()),this.processor.pipe(new Je("reverse").append(Or,$r,xr,Rr,Dr,_r).shouldHaveResult())}options(e){return this.processor.options(e)}diff(e,r){return this.processor.process(new se(e,r))}patch(e,r){return this.processor.process(new ht(e,r))}reverse(e){return this.processor.process(new pt(e))}unpatch(e,r){return this.patch(e,this.reverse(r))}clone(e){return ke(e)}}function rs(t){return new ts(t)}var Br=typeof global=="object"&&global&&global.Object===Object&&global,ns=typeof self=="object"&&self&&self.Object===Object&&self,J=Br||ns||Function("return this")(),he=J.Symbol,Fr=Object.prototype,ss=Fr.hasOwnProperty,is=Fr.toString,we=he?he.toStringTag:void 0;function as(t){var e=ss.call(t,we),r=t[we];try{t[we]=void 0;var n=!0}catch{}var s=is.call(t);return n&&(e?t[we]=r:delete t[we]),s}var os=Object.prototype,cs=os.toString;function us(t){return cs.call(t)}var ls="[object Null]",fs="[object Undefined]",It=he?he.toStringTag:void 0;function je(t){return t==null?t===void 0?fs:ls:It&&It in Object(t)?as(t):us(t)}function Ae(t){return t!=null&&typeof t=="object"}var yt=Array.isArray;function Ue(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var ds="[object AsyncFunction]",hs="[object Function]",ps="[object GeneratorFunction]",ys="[object Proxy]";function Lr(t){if(!Ue(t))return!1;var e=je(t);return e==hs||e==ps||e==ds||e==ys}var Ze=J["__core-js_shared__"],Ct=(function(){var t=/[^.]+$/.exec(Ze&&Ze.keys&&Ze.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""})();function gs(t){return!!Ct&&Ct in t}var ms=Function.prototype,bs=ms.toString;function oe(t){if(t!=null){try{return bs.call(t)}catch{}try{return t+""}catch{}}return""}var ws=/[\\^$.*+?()[\]{}|]/g,vs=/^\[object .+?Constructor\]$/,_s=Function.prototype,$s=Object.prototype,Ms=_s.toString,Ss=$s.hasOwnProperty,js=RegExp("^"+Ms.call(Ss).replace(ws,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function As(t){if(!Ue(t)||gs(t))return!1;var e=Lr(t)?js:vs;return e.test(oe(t))}function Ts(t,e){return t?.[e]}function ce(t,e){var r=Ts(t,e);return As(r)?r:void 0}var ot=ce(J,"WeakMap"),Rt=Object.create,Ds=(function(){function t(){}return function(e){if(!Ue(e))return{};if(Rt)return Rt(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}})(),Pt=(function(){try{var t=ce(Object,"defineProperty");return t({},"",{}),t}catch{}})();function Os(t,e){for(var r=-1,n=t==null?0:t.length;++r<n&&e(t[r],r,t)!==!1;);return t}var Es=9007199254740991,Is=/^(?:0|[1-9]\d*)$/;function Cs(t,e){var r=typeof t;return e=e??Es,!!e&&(r=="number"||r!="symbol"&&Is.test(t))&&t>-1&&t%1==0&&t<e}function Rs(t,e,r){e=="__proto__"&&Pt?Pt(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}function kr(t,e){return t===e||t!==t&&e!==e}var Ps=Object.prototype,Ns=Ps.hasOwnProperty;function xs(t,e,r){var n=t[e];(!(Ns.call(t,e)&&kr(n,r))||r===void 0&&!(e in t))&&Rs(t,e,r)}var Bs=9007199254740991;function Vr(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=Bs}function Fs(t){return t!=null&&Vr(t.length)&&!Lr(t)}var Ls=Object.prototype;function Hr(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||Ls;return t===r}function ks(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}var Vs="[object Arguments]";function Nt(t){return Ae(t)&&je(t)==Vs}var Ur=Object.prototype,Hs=Ur.hasOwnProperty,Us=Ur.propertyIsEnumerable,Ws=Nt((function(){return arguments})())?Nt:function(t){return Ae(t)&&Hs.call(t,"callee")&&!Us.call(t,"callee")};function Ys(){return!1}var Wr=typeof U=="object"&&U&&!U.nodeType&&U,xt=Wr&&typeof W=="object"&&W&&!W.nodeType&&W,zs=xt&&xt.exports===Wr,Bt=zs?J.Buffer:void 0,Gs=Bt?Bt.isBuffer:void 0,Yr=Gs||Ys,Ks="[object Arguments]",qs="[object Array]",Js="[object Boolean]",Xs="[object Date]",Zs="[object Error]",Qs="[object Function]",ei="[object Map]",ti="[object Number]",ri="[object Object]",ni="[object RegExp]",si="[object Set]",ii="[object String]",ai="[object WeakMap]",oi="[object ArrayBuffer]",ci="[object DataView]",ui="[object Float32Array]",li="[object Float64Array]",fi="[object Int8Array]",di="[object Int16Array]",hi="[object Int32Array]",pi="[object Uint8Array]",yi="[object Uint8ClampedArray]",gi="[object Uint16Array]",mi="[object Uint32Array]",D={};D[ui]=D[li]=D[fi]=D[di]=D[hi]=D[pi]=D[yi]=D[gi]=D[mi]=!0;D[Ks]=D[qs]=D[oi]=D[Js]=D[ci]=D[Xs]=D[Zs]=D[Qs]=D[ei]=D[ti]=D[ri]=D[ni]=D[si]=D[ii]=D[ai]=!1;function bi(t){return Ae(t)&&Vr(t.length)&&!!D[je(t)]}function gt(t){return function(e){return t(e)}}var zr=typeof U=="object"&&U&&!U.nodeType&&U,_e=zr&&typeof W=="object"&&W&&!W.nodeType&&W,wi=_e&&_e.exports===zr,Qe=wi&&Br.process,pe=(function(){try{var t=_e&&_e.require&&_e.require("util").types;return t||Qe&&Qe.binding&&Qe.binding("util")}catch{}})(),Ft=pe&&pe.isTypedArray,vi=Ft?gt(Ft):bi,_i=Object.prototype,$i=_i.hasOwnProperty;function Mi(t,e){var r=yt(t),n=!r&&Ws(t),s=!r&&!n&&Yr(t),i=!r&&!n&&!s&&vi(t),a=r||n||s||i,c=a?ks(t.length,String):[],u=c.length;for(var o in t)$i.call(t,o)&&!(a&&(o=="length"||s&&(o=="offset"||o=="parent")||i&&(o=="buffer"||o=="byteLength"||o=="byteOffset")||Cs(o,u)))&&c.push(o);return c}function Gr(t,e){return function(r){return t(e(r))}}var Si=Gr(Object.keys,Object),ji=Object.prototype,Ai=ji.hasOwnProperty;function Ti(t){if(!Hr(t))return Si(t);var e=[];for(var r in Object(t))Ai.call(t,r)&&r!="constructor"&&e.push(r);return e}function Di(t){return Fs(t)?Mi(t):Ti(t)}var $e=ce(Object,"create");function Oi(){this.__data__=$e?$e(null):{},this.size=0}function Ei(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var Ii="__lodash_hash_undefined__",Ci=Object.prototype,Ri=Ci.hasOwnProperty;function Pi(t){var e=this.__data__;if($e){var r=e[t];return r===Ii?void 0:r}return Ri.call(e,t)?e[t]:void 0}var Ni=Object.prototype,xi=Ni.hasOwnProperty;function Bi(t){var e=this.__data__;return $e?e[t]!==void 0:xi.call(e,t)}var Fi="__lodash_hash_undefined__";function Li(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=$e&&e===void 0?Fi:e,this}function ae(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}ae.prototype.clear=Oi;ae.prototype.delete=Ei;ae.prototype.get=Pi;ae.prototype.has=Bi;ae.prototype.set=Li;function ki(){this.__data__=[],this.size=0}function We(t,e){for(var r=t.length;r--;)if(kr(t[r][0],e))return r;return-1}var Vi=Array.prototype,Hi=Vi.splice;function Ui(t){var e=this.__data__,r=We(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():Hi.call(e,r,1),--this.size,!0}function Wi(t){var e=this.__data__,r=We(e,t);return r<0?void 0:e[r][1]}function Yi(t){return We(this.__data__,t)>-1}function zi(t,e){var r=this.__data__,n=We(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this}function Z(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Z.prototype.clear=ki;Z.prototype.delete=Ui;Z.prototype.get=Wi;Z.prototype.has=Yi;Z.prototype.set=zi;var Me=ce(J,"Map");function Gi(){this.size=0,this.__data__={hash:new ae,map:new(Me||Z),string:new ae}}function Ki(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function Ye(t,e){var r=t.__data__;return Ki(e)?r[typeof e=="string"?"string":"hash"]:r.map}function qi(t){var e=Ye(this,t).delete(t);return this.size-=e?1:0,e}function Ji(t){return Ye(this,t).get(t)}function Xi(t){return Ye(this,t).has(t)}function Zi(t,e){var r=Ye(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this}function ye(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}ye.prototype.clear=Gi;ye.prototype.delete=qi;ye.prototype.get=Ji;ye.prototype.has=Xi;ye.prototype.set=Zi;function Qi(t,e){for(var r=-1,n=e.length,s=t.length;++r<n;)t[s+r]=e[r];return t}var ea=Gr(Object.getPrototypeOf,Object);function ta(){this.__data__=new Z,this.size=0}function ra(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}function na(t){return this.__data__.get(t)}function sa(t){return this.__data__.has(t)}var ia=200;function aa(t,e){var r=this.__data__;if(r instanceof Z){var n=r.__data__;if(!Me||n.length<ia-1)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new ye(n)}return r.set(t,e),this.size=r.size,this}function ge(t){var e=this.__data__=new Z(t);this.size=e.size}ge.prototype.clear=ta;ge.prototype.delete=ra;ge.prototype.get=na;ge.prototype.has=sa;ge.prototype.set=aa;var Kr=typeof U=="object"&&U&&!U.nodeType&&U,Lt=Kr&&typeof W=="object"&&W&&!W.nodeType&&W,oa=Lt&&Lt.exports===Kr,kt=oa?J.Buffer:void 0;kt&&kt.allocUnsafe;function ca(t,e){return t.slice()}function ua(t,e){for(var r=-1,n=t==null?0:t.length,s=0,i=[];++r<n;){var a=t[r];e(a,r,t)&&(i[s++]=a)}return i}function la(){return[]}var fa=Object.prototype,da=fa.propertyIsEnumerable,Vt=Object.getOwnPropertySymbols,ha=Vt?function(t){return t==null?[]:(t=Object(t),ua(Vt(t),function(e){return da.call(t,e)}))}:la;function pa(t,e,r){var n=e(t);return yt(t)?n:Qi(n,r(t))}function ya(t){return pa(t,Di,ha)}var ct=ce(J,"DataView"),ut=ce(J,"Promise"),lt=ce(J,"Set"),Ht="[object Map]",ga="[object Object]",Ut="[object Promise]",Wt="[object Set]",Yt="[object WeakMap]",zt="[object DataView]",ma=oe(ct),ba=oe(Me),wa=oe(ut),va=oe(lt),_a=oe(ot),X=je;(ct&&X(new ct(new ArrayBuffer(1)))!=zt||Me&&X(new Me)!=Ht||ut&&X(ut.resolve())!=Ut||lt&&X(new lt)!=Wt||ot&&X(new ot)!=Yt)&&(X=function(t){var e=je(t),r=e==ga?t.constructor:void 0,n=r?oe(r):"";if(n)switch(n){case ma:return zt;case ba:return Ht;case wa:return Ut;case va:return Wt;case _a:return Yt}return e});var $a=Object.prototype,Ma=$a.hasOwnProperty;function Sa(t){var e=t.length,r=new t.constructor(e);return e&&typeof t[0]=="string"&&Ma.call(t,"index")&&(r.index=t.index,r.input=t.input),r}var Gt=J.Uint8Array;function mt(t){var e=new t.constructor(t.byteLength);return new Gt(e).set(new Gt(t)),e}function ja(t,e){var r=mt(t.buffer);return new t.constructor(r,t.byteOffset,t.byteLength)}var Aa=/\w*$/;function Ta(t){var e=new t.constructor(t.source,Aa.exec(t));return e.lastIndex=t.lastIndex,e}var Kt=he?he.prototype:void 0,qt=Kt?Kt.valueOf:void 0;function Da(t){return qt?Object(qt.call(t)):{}}function Oa(t,e){var r=mt(t.buffer);return new t.constructor(r,t.byteOffset,t.length)}var Ea="[object Boolean]",Ia="[object Date]",Ca="[object Map]",Ra="[object Number]",Pa="[object RegExp]",Na="[object Set]",xa="[object String]",Ba="[object Symbol]",Fa="[object ArrayBuffer]",La="[object DataView]",ka="[object Float32Array]",Va="[object Float64Array]",Ha="[object Int8Array]",Ua="[object Int16Array]",Wa="[object Int32Array]",Ya="[object Uint8Array]",za="[object Uint8ClampedArray]",Ga="[object Uint16Array]",Ka="[object Uint32Array]";function qa(t,e,r){var n=t.constructor;switch(e){case Fa:return mt(t);case Ea:case Ia:return new n(+t);case La:return ja(t);case ka:case Va:case Ha:case Ua:case Wa:case Ya:case za:case Ga:case Ka:return Oa(t);case Ca:return new n;case Ra:case xa:return new n(t);case Pa:return Ta(t);case Na:return new n;case Ba:return Da(t)}}function Ja(t){return typeof t.constructor=="function"&&!Hr(t)?Ds(ea(t)):{}}var Xa="[object Map]";function Za(t){return Ae(t)&&X(t)==Xa}var Jt=pe&&pe.isMap,Qa=Jt?gt(Jt):Za,eo="[object Set]";function to(t){return Ae(t)&&X(t)==eo}var Xt=pe&&pe.isSet,ro=Xt?gt(Xt):to,qr="[object Arguments]",no="[object Array]",so="[object Boolean]",io="[object Date]",ao="[object Error]",Jr="[object Function]",oo="[object GeneratorFunction]",co="[object Map]",uo="[object Number]",Xr="[object Object]",lo="[object RegExp]",fo="[object Set]",ho="[object String]",po="[object Symbol]",yo="[object WeakMap]",go="[object ArrayBuffer]",mo="[object DataView]",bo="[object Float32Array]",wo="[object Float64Array]",vo="[object Int8Array]",_o="[object Int16Array]",$o="[object Int32Array]",Mo="[object Uint8Array]",So="[object Uint8ClampedArray]",jo="[object Uint16Array]",Ao="[object Uint32Array]",A={};A[qr]=A[no]=A[go]=A[mo]=A[so]=A[io]=A[bo]=A[wo]=A[vo]=A[_o]=A[$o]=A[co]=A[uo]=A[Xr]=A[lo]=A[fo]=A[ho]=A[po]=A[Mo]=A[So]=A[jo]=A[Ao]=!0;A[ao]=A[Jr]=A[yo]=!1;function Ce(t,e,r,n,s,i){var a;if(a!==void 0)return a;if(!Ue(t))return t;var c=yt(t);if(c)a=Sa(t);else{var u=X(t),o=u==Jr||u==oo;if(Yr(t))return ca(t);if(u==Xr||u==qr||o&&!s)a=o?{}:Ja(t);else{if(!A[u])return s?t:{};a=qa(t,u)}}i||(i=new ge);var l=i.get(t);if(l)return l;i.set(t,a),ro(t)?t.forEach(function(d){a.add(Ce(d,e,r,d,t,i))}):Qa(t)&&t.forEach(function(d,_){a.set(_,Ce(d,e,r,_,t,i))});var y=ya,b=c?void 0:y(t);return Os(b||t,function(d,_){b&&(_=d,d=t[_]),xs(a,_,Ce(d,e,r,_,t,i))}),a}var To=1,Do=4;function Oo(t){return Ce(t,To|Do)}function Eo(){return rs({arrays:{detectMove:!0,includeValueOnMove:!0},objectHash:t=>{if(!t||typeof t!="object")return"";const e=["id","key","name","uid","_id"];for(const r of e)if(Object.hasOwn(t,r)){const n=t[r];if(typeof n=="string"||typeof n=="number")return String(n)}try{return JSON.stringify(t)}catch{return String(t)}}})}function Io(t){if(!t||typeof t!="object"||Array.isArray(t)||!t.$$meta&&!Object.keys(t).some(r=>r.startsWith("$")))return t;const e={...t};delete e.$$meta;for(const r of Object.keys(e))r.startsWith("$")&&delete e[r];return e}const Co=Oo;function Ro(t,e,r){const n=Eo(),s=(()=>{const a=e&&typeof e=="object"&&e.$$meta||null,c=a&&typeof a.priority<"u"?Number(a.priority):null;return{orig:e,noMeta:Io(e),keyPriority:c}})(),i=Co(t);if(Array.isArray(s.noMeta))throw new Error("Patch root cannot be an array delta. Wrap patch inside an object.");try{n.patch(i,s.noMeta)}catch(a){throw new Error("Failed to apply patch during merge: "+String(a))}return i}class C{static STASH_NAME="__stashes";static ITEM_NAME="__items";static META_NAME="__meta";static CONFIG_NAME="__config";factory;metaFactory;constructor(e,r){this.factory=e,this.metaFactory=r}get metaStorage(){return this.metaFactory(C.META_NAME)}get stashStorage(){return this.factory(C.STASH_NAME)}get itemStorage(){return this.factory(C.ITEM_NAME)}get configStorage(){return this.metaFactory(C.CONFIG_NAME)}async init(e,r){r!==void 0&&await this.metaStorage.setValue(r),await this.itemStorage.clear(),await this.applyStash(e);const n=await this.getStashes();await this.applyStash(n)}async patch(e,r){r!==void 0&&await this.metaStorage.setValue(r),await this.applyStash(e);const n=await this.getStashes();await this.applyStash(n)}getItems(e){return this.itemStorage.toArray(e)}getStashes(){return this.stashStorage.toArray()}async getMeta(){const e=await this.metaStorage.getValue(),n=(await this.getStashes()).find(i=>i.type==="meta");return n?xo(e,n.metaValue):e}async batch(e,r=!1){const n=Date.now(),s=e.map(o=>({...o,id:Vn(),timestamp:o.timestamp??n})),i=s.find(o=>o.type==="meta");if(i){const o=await this.metaStorage.getValue();i.metaValue=No(o??{},i.metaValue)}const a=await this.getStashes(),c=Po([...s,...r?[]:a]);if(r){const o=Date.now();c[0].overlap=o,c[c.length-1]&&(c[c.length-1].overlap=o),c[c.length-2]&&(c[c.length-2].overlap=o),await this.itemStorage.clear()}await this.stashStorage.clear(),await this.stashStorage.put(...c);const u=await this.stashStorage.toArray();await this.applyStash(u)}async applyStash(e){const{updates:r,deletes:n}=e.reduce((s,i)=>(i.type==="update"?s.updates.push(i):i.type==="delete"&&s.deletes.push(i),s),{updates:[],deletes:[]});await Promise.all([this.itemStorage.put(...r.map(s=>({__create_at:s.timestamp,__update_at:s.timestamp,...s.value}))),this.itemStorage.delete(...n.map(s=>s.value))])}async deleteStashes(...e){this.stashStorage.delete(...e)}}function Po(t){const e=new Set;return t.filter(r=>{const n=r.type==="meta"?"_meta":r.type==="delete"?r.value:r.value.id;return e.has(n)?!1:(e.add(n),!0)})}const No=(t,e)=>e,xo=(t,e)=>{if(e.$$meta){const r=Ro(t,e);return r.__updated_at=e.$$meta.timestamp,delete r.$$meta,r}return e},Bo=2;class Fo{dbName;constructor(e){this.dbName=e}getDB(){return fr(this.dbName,Bo,{upgrade:(e,r,n,s)=>{if(e.objectStoreNames.contains(C.STASH_NAME)||e.createObjectStore(C.STASH_NAME,{autoIncrement:!0,keyPath:"id"}).createIndex("timestamp","timestamp"),!e.objectStoreNames.contains(C.ITEM_NAME)){const i=e.createObjectStore(C.ITEM_NAME,{keyPath:"id"});i.createIndex("time","time"),i.createIndex("creatorId","creatorId")}e.objectStoreNames.contains(C.META_NAME)||e.createObjectStore(C.META_NAME,{autoIncrement:!0,keyPath:"id"}),e.objectStoreNames.contains(C.CONFIG_NAME)||e.createObjectStore(C.CONFIG_NAME,{autoIncrement:!0,keyPath:"id"})}})}createArrayableStorage=e=>({put:async(...r)=>{const n=await this.getDB(),s=n.transaction(e,"readwrite"),i=s.objectStore(e);await Promise.all(r.map(a=>i.put(a))),await s.done,n.close()},delete:async(...r)=>{const n=await this.getDB(),s=n.transaction(e,"readwrite"),i=s.objectStore(e);await Promise.all(r.map(a=>i.delete(a))),await s.done,n.close()},clear:async()=>{const r=await this.getDB();await r.clear(e),r.close()},toArray:async r=>{const n=await this.getDB(),{store:s,index:i}=(()=>{if(e===C.STASH_NAME){const b=n.transaction(C.STASH_NAME).objectStore(C.STASH_NAME),d=b.index("timestamp");return{store:b,index:d}}const l=n.transaction(C.ITEM_NAME).objectStore(C.ITEM_NAME),y=l.index("time");return{store:l,index:y}})(),a="prev",c=[],u=IDBKeyRange.bound(-1/0,1/0);let o=await i.openCursor(u,a);for(;o&&(c.push(o.value),!(r!==void 0&&c.length>=r));)o=await o.continue();return n.close(),c}});createStorage=e=>({setValue:async r=>{const n=await this.getDB(),s=n.transaction(e,"readwrite");await s.objectStore(e).put({id:"metaKey",value:r}),await s.done,n.close()},getValue:async()=>{const r=await this.getDB(),n=r.transaction(e,"readonly"),i=await n.objectStore(e).get("metaKey");return await n.done,r.close(),i?.value}});dangerousClearAll=async()=>{const e=await indexedDB.databases();await Promise.all(e.map(r=>{const n=r.name;if(n!==void 0)return dr(n)}))}}function bt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Re={exports:{}},Lo=Re.exports,Zt;function ko(){return Zt||(Zt=1,(function(t,e){(function(r,n){t.exports=n()})(Lo,(function(){var r=1e3,n=6e4,s=36e5,i="millisecond",a="second",c="minute",u="hour",o="day",l="week",y="month",b="quarter",d="year",_="date",E="Invalid Date",P=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,F=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,j={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(m){var p=["th","st","nd","rd"],f=m%100;return"["+m+(p[(f-20)%10]||p[f]||p[0])+"]"}},z=function(m,p,f){var g=String(m);return!g||g.length>=p?m:""+Array(p+1-g.length).join(f)+m},G={s:z,z:function(m){var p=-m.utcOffset(),f=Math.abs(p),g=Math.floor(f/60),h=f%60;return(p<=0?"+":"-")+z(g,2,"0")+":"+z(h,2,"0")},m:function m(p,f){if(p.date()<f.date())return-m(f,p);var g=12*(f.year()-p.year())+(f.month()-p.month()),h=p.clone().add(g,y),v=f-h<0,w=p.clone().add(g+(v?-1:1),y);return+(-(g+(f-h)/(v?h-w:w-h))||0)},a:function(m){return m<0?Math.ceil(m)||0:Math.floor(m)},p:function(m){return{M:y,y:d,w:l,d:o,D:_,h:u,m:c,s:a,ms:i,Q:b}[m]||String(m||"").toLowerCase().replace(/s$/,"")},u:function(m){return m===void 0}},R="en",N={};N[R]=j;var q="$isDayjsObject",H=function(m){return m instanceof L||!(!m||!m[q])},K=function m(p,f,g){var h;if(!p)return R;if(typeof p=="string"){var v=p.toLowerCase();N[v]&&(h=v),f&&(N[v]=f,h=v);var w=p.split("-");if(!h&&w.length>1)return m(w[0])}else{var S=p.name;N[S]=p,h=S}return!g&&h&&(R=h),h||!g&&R},M=function(m,p){if(H(m))return m.clone();var f=typeof p=="object"?p:{};return f.date=m,f.args=arguments,new L(f)},$=G;$.l=K,$.i=H,$.w=function(m,p){return M(m,{locale:p.$L,utc:p.$u,x:p.$x,$offset:p.$offset})};var L=(function(){function m(f){this.$L=K(f.locale,null,!0),this.parse(f),this.$x=this.$x||f.x||{},this[q]=!0}var p=m.prototype;return p.parse=function(f){this.$d=(function(g){var h=g.date,v=g.utc;if(h===null)return new Date(NaN);if($.u(h))return new Date;if(h instanceof Date)return new Date(h);if(typeof h=="string"&&!/Z$/i.test(h)){var w=h.match(P);if(w){var S=w[2]-1||0,T=(w[7]||"0").substring(0,3);return v?new Date(Date.UTC(w[1],S,w[3]||1,w[4]||0,w[5]||0,w[6]||0,T)):new Date(w[1],S,w[3]||1,w[4]||0,w[5]||0,w[6]||0,T)}}return new Date(h)})(f),this.init()},p.init=function(){var f=this.$d;this.$y=f.getFullYear(),this.$M=f.getMonth(),this.$D=f.getDate(),this.$W=f.getDay(),this.$H=f.getHours(),this.$m=f.getMinutes(),this.$s=f.getSeconds(),this.$ms=f.getMilliseconds()},p.$utils=function(){return $},p.isValid=function(){return this.$d.toString()!==E},p.isSame=function(f,g){var h=M(f);return this.startOf(g)<=h&&h<=this.endOf(g)},p.isAfter=function(f,g){return M(f)<this.startOf(g)},p.isBefore=function(f,g){return this.endOf(g)<M(f)},p.$g=function(f,g,h){return $.u(f)?this[g]:this.set(h,f)},p.unix=function(){return Math.floor(this.valueOf()/1e3)},p.valueOf=function(){return this.$d.getTime()},p.startOf=function(f,g){var h=this,v=!!$.u(g)||g,w=$.p(f),S=function(re,V){var Q=$.w(h.$u?Date.UTC(h.$y,V,re):new Date(h.$y,V,re),h);return v?Q:Q.endOf(o)},T=function(re,V){return $.w(h.toDate()[re].apply(h.toDate("s"),(v?[0,0,0,0]:[23,59,59,999]).slice(V)),h)},O=this.$W,I=this.$M,k=this.$D,ue="set"+(this.$u?"UTC":"");switch(w){case d:return v?S(1,0):S(31,11);case y:return v?S(1,I):S(0,I+1);case l:var te=this.$locale().weekStart||0,me=(O<te?O+7:O)-te;return S(v?k-me:k+(6-me),I);case o:case _:return T(ue+"Hours",0);case u:return T(ue+"Minutes",1);case c:return T(ue+"Seconds",2);case a:return T(ue+"Milliseconds",3);default:return this.clone()}},p.endOf=function(f){return this.startOf(f,!1)},p.$set=function(f,g){var h,v=$.p(f),w="set"+(this.$u?"UTC":""),S=(h={},h[o]=w+"Date",h[_]=w+"Date",h[y]=w+"Month",h[d]=w+"FullYear",h[u]=w+"Hours",h[c]=w+"Minutes",h[a]=w+"Seconds",h[i]=w+"Milliseconds",h)[v],T=v===o?this.$D+(g-this.$W):g;if(v===y||v===d){var O=this.clone().set(_,1);O.$d[S](T),O.init(),this.$d=O.set(_,Math.min(this.$D,O.daysInMonth())).$d}else S&&this.$d[S](T);return this.init(),this},p.set=function(f,g){return this.clone().$set(f,g)},p.get=function(f){return this[$.p(f)]()},p.add=function(f,g){var h,v=this;f=Number(f);var w=$.p(g),S=function(I){var k=M(v);return $.w(k.date(k.date()+Math.round(I*f)),v)};if(w===y)return this.set(y,this.$M+f);if(w===d)return this.set(d,this.$y+f);if(w===o)return S(1);if(w===l)return S(7);var T=(h={},h[c]=n,h[u]=s,h[a]=r,h)[w]||1,O=this.$d.getTime()+f*T;return $.w(O,this)},p.subtract=function(f,g){return this.add(-1*f,g)},p.format=function(f){var g=this,h=this.$locale();if(!this.isValid())return h.invalidDate||E;var v=f||"YYYY-MM-DDTHH:mm:ssZ",w=$.z(this),S=this.$H,T=this.$m,O=this.$M,I=h.weekdays,k=h.months,ue=h.meridiem,te=function(V,Q,be,Te){return V&&(V[Q]||V(g,v))||be[Q].slice(0,Te)},me=function(V){return $.s(S%12||12,V,"0")},re=ue||function(V,Q,be){var Te=V<12?"AM":"PM";return be?Te.toLowerCase():Te};return v.replace(F,(function(V,Q){return Q||(function(be){switch(be){case"YY":return String(g.$y).slice(-2);case"YYYY":return $.s(g.$y,4,"0");case"M":return O+1;case"MM":return $.s(O+1,2,"0");case"MMM":return te(h.monthsShort,O,k,3);case"MMMM":return te(k,O);case"D":return g.$D;case"DD":return $.s(g.$D,2,"0");case"d":return String(g.$W);case"dd":return te(h.weekdaysMin,g.$W,I,2);case"ddd":return te(h.weekdaysShort,g.$W,I,3);case"dddd":return I[g.$W];case"H":return String(S);case"HH":return $.s(S,2,"0");case"h":return me(1);case"hh":return me(2);case"a":return re(S,T,!0);case"A":return re(S,T,!1);case"m":return String(T);case"mm":return $.s(T,2,"0");case"s":return String(g.$s);case"ss":return $.s(g.$s,2,"0");case"SSS":return $.s(g.$ms,3,"0");case"Z":return w}return null})(V)||w.replace(":","")}))},p.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},p.diff=function(f,g,h){var v,w=this,S=$.p(g),T=M(f),O=(T.utcOffset()-this.utcOffset())*n,I=this-T,k=function(){return $.m(w,T)};switch(S){case d:v=k()/12;break;case y:v=k();break;case b:v=k()/3;break;case l:v=(I-O)/6048e5;break;case o:v=(I-O)/864e5;break;case u:v=I/s;break;case c:v=I/n;break;case a:v=I/r;break;default:v=I}return h?v:$.a(v)},p.daysInMonth=function(){return this.endOf(y).$D},p.$locale=function(){return N[this.$L]},p.locale=function(f,g){if(!f)return this.$L;var h=this.clone(),v=K(f,g,!0);return v&&(h.$L=v),h},p.clone=function(){return $.w(this.$d,this)},p.toDate=function(){return new Date(this.valueOf())},p.toJSON=function(){return this.isValid()?this.toISOString():null},p.toISOString=function(){return this.$d.toISOString()},p.toString=function(){return this.$d.toUTCString()},m})(),Y=L.prototype;return M.prototype=Y,[["$ms",i],["$s",a],["$m",c],["$H",u],["$W",o],["$M",y],["$y",d],["$D",_]].forEach((function(m){Y[m[1]]=function(p){return this.$g(p,m[0],m[1])}})),M.extend=function(m,p){return m.$i||(m(p,L,M),m.$i=!0),M},M.locale=K,M.isDayjs=H,M.unix=function(m){return M(1e3*m)},M.en=N[R],M.Ls=N,M.p={},M}))})(Re)),Re.exports}var Vo=ko(),B=bt(Vo),Pe={exports:{}},Ho=Pe.exports,Qt;function Uo(){return Qt||(Qt=1,(function(t,e){(function(r,n){t.exports=n()})(Ho,(function(){return function(r,n){n.prototype.isSameOrAfter=function(s,i){return this.isSame(s,i)||this.isAfter(s,i)}}}))})(Pe)),Pe.exports}var Wo=Uo(),Zr=bt(Wo),Ne={exports:{}},Yo=Ne.exports,er;function zo(){return er||(er=1,(function(t,e){(function(r,n){t.exports=n()})(Yo,(function(){return function(r,n){n.prototype.isSameOrBefore=function(s,i){return this.isSame(s,i)||this.isBefore(s,i)}}}))})(Ne)),Ne.exports}var Go=zo(),Qr=bt(Go);const tr=t=>Number((t*1e4).toFixed(0)),Ko="CNY";B.extend(Qr);B.extend(Zr);const qo=(t,e)=>e===void 0?!0:t.type===e,Jo=(t,e,r,n)=>{const s=B.unix(t.time/1e3),{start:i,end:a}=(()=>{if(n)return{start:B().subtract(n.value,n.unit).startOf("day"),end:void 0};const c=e===void 0?void 0:typeof e=="number"?B.unix(e/1e3):B(e),u=r===void 0?void 0:typeof r=="number"?B.unix(r/1e3):B(r);return{start:c,end:u}})();return i?a?s.isSameOrAfter(i)&&s.isSameOrBefore(a):s.isSameOrAfter(i):a?s.isSameOrBefore(a):!0},Xo=(t,e=-1/0,r=1/0)=>{const n=tr(e),s=tr(r),[i,a]=n<s?[n,s]:[s,n];return t.amount<=a&&t.amount>=i},Zo=(t,e)=>e?.length?e.some(r=>t.creatorId===r):!0,Qo=(t,e)=>e?.length?e.some(r=>t.categoryId===r):!0,ec=(t,e)=>e?!!t.comment?.includes(e):!0,tc=(t,e)=>e===!0?t.images?.some(r=>!!r):!0,rc=(t,e)=>e?.length?e.some(r=>t.tagIds?.some(n=>n===r)):!0,nc=(t,e)=>(e?.length??0)===0?!0:e?.every(r=>!t.tagIds?.includes(r)),sc=(t,e,r)=>r?.length?r.some(n=>(t.currency?.target??e)===n):!0,ic=(t,e)=>qo(t,e.type)&&Zo(t,e.creators)&&Qo(t,e.categories)&&Xo(t,e.minAmountNumber,e.maxAmountNumber)&&Jo(t,e.start,e.end,e.recent)&&tc(t,e.assets)&&ec(t,e.comment)&&rc(t,e.tags)&&sc(t,e.baseCurrency??Ko,e.currencies)&&nc(t,e.excludeTags);async function ac(t){return new Promise((e,r)=>{const n=new FileReader;n.onload=()=>{const i=n.result.split(",")[1];e(i)},n.onerror=s=>r(s),n.readAsDataURL(t)})}B.extend(Zr);B.extend(Qr);const le=1440*60*1e3,oc=7,cc=30.436875,uc=365.2425;function ve(t,e){if(e==="income")return t.filter(r=>r.type==="income").reduce((r,n)=>r+n.amount,0);if(e==="expense")return t.filter(r=>r.type==="expense").reduce((r,n)=>r+n.amount,0);{const r=t.filter(s=>s.type==="income").reduce((s,i)=>s+i.amount,0),n=t.filter(s=>s.type==="expense").reduce((s,i)=>s+i.amount,0);return r-n}}function fe(t,e){const r=e>0?e:11574074074074074e-24;return{total:t,days:e,dayAvg:t/r,weekAvg:t/(r/oc),monthAvg:t/(r/cc),yearAvg:t/(r/uc)}}const lc=async(t,e,r,n)=>{if(!n)throw new Error("fetchBills 必须提供");const[s,i]=t;if(s>=i)throw new Error("dateRange start must be < end");const c=B(s),u=async($,L)=>{const Y=await n([$,L]),m=Math.max(0,L-$),p=m/le,f=L,g=Math.max(0,f-$),h=g/le,v=Y.filter(I=>I.time<f),w=ve(v,e);let S;g<=0?S=0:g>=m?S=w:S=w/g*m;const T=fe(w,h>0?h:p),O=fe(S,p);return{currentDetail:T,projectedDetail:O,bills:Y}};if(!r){const{currentDetail:$,projectedDetail:L,bills:Y}=await u(s,i),m=s-(i-s),p=s,f=B(s).subtract(1,"year").valueOf(),g=B(i).subtract(1,"year").valueOf(),h=await n([m,p]),v=ve(h,e),w=(p-m)/le,S=fe(v,w),T=await n([f,g]),O=ve(T,e),I=(g-f)/le,k=fe(O,I);return{current:$,projected:L,previous:S,lastYear:k,bills:Y}}const o=c.startOf(r),l=o.valueOf(),y=o.add(1,r).valueOf(),b=B(l).subtract(1,r).valueOf(),d=l,_=B(l).subtract(1,"year").valueOf(),E=B(y).subtract(1,"year").valueOf(),{currentDetail:P,projectedDetail:F,bills:j}=await u(l,y),z=await n([b,d]),G=ve(z,e),R=(d-b)/le,N=fe(G,R),q=await n([_,E]),H=ve(q,e),K=(E-_)/le,M=fe(H,K);return{current:P,projected:F,previous:N,lastYear:M,bills:j}},rr=new Map,wt=t=>{const e=rr.get(t),r=e?.itemStorage??new Fo(`book-${t}`),n=e?.itemBucket??new C(r.createArrayableStorage,r.createStorage);return rr.set(t,{...e,itemStorage:r,itemBucket:n}),{itemBucket:n}},Se=async(t,e)=>(await wt(t).itemBucket.getItems()).filter(n=>ic(n,e)),fc=async(t,e)=>await wt(t).itemBucket.getItems(e),en=async t=>({meta:await wt(t).itemBucket.getMeta()??{}}),dc=async(t,e,r,n)=>await lc(e,n,r,i=>Se(t,{start:i[0],end:i[1]})),hc=async t=>{const{meta:e}=await en(t),r=await Se(t,{});return await Promise.all(r.map(async s=>{const i=s.images?await Promise.all(s.images?.map(async a=>{if(a instanceof File){const c=await ac(a);return`data:${a.type};base64,${c}`}return a})):void 0;return s.images=i,s})),JSON.stringify({meta:e,items:r})},pc=async t=>{const e=await hc(t),r=new TextEncoder().encode(e);return ur(r.buffer,[r.buffer])},yc=async(t,e)=>{const r=await Pn(t),n=await(async()=>r?.timeRange?Se(t,{start:r.timeRange[1]+1,creators:e}):Se(t,{creators:e}))();if(n.length===0)return;console.log(`start learning new ${n.length} bills`);const s=n[0]?.time,i=n[n.length-1]?.time;await Rn(t,n,{timeRange:[i,s]})},gc=async(t,e,r=Date.now())=>Nn(t,e,r),mc={init:t=>{},getInfo:en,filter:Se,analysis:dc,exportToArrayBuffer:pc,learn:yc,predict:gc,clearModels:xn,truncate:fc};ft(mc)});export default bc();
