import{a6 as v,a4 as B,a7 as W,a8 as X}from"./index-fn45pqzM.js";import{r as f,j as e,u as k}from"./index-C61yflYx.js";import{D as w,x as b,K as Y,y as C,N as I,J as U,O as Z,Q as _,U as H,e as ee,d as se,n as te,c as L,S as F,q as P,V as R,r as V,v as N,z as D,W as ne,X as le,Y as ae,Z as re,_ as ie,$ as ce,l as q,j as z}from"./route-BFOsbA1u.js";const $=t=>{let a=[];if(t.children)for(const c of t.children)a.push(c.id),a=[...a,...$(c)];return a},de=({item:t,selectedIds:a,onBatchChange:c,align:n})=>{const u=a.has(t.id),r=t.children&&t.children.length>0,i=()=>{const x=[t.id,...$(t)];c(x,!u)},h=e.jsxs("div",{className:"flex items-center w-full cursor-pointer",onClick:i,children:[e.jsx(U,{id:`checkbox-${t.id}`,checked:u,className:"mr-2 pointer-events-none"}),e.jsx("label",{htmlFor:`checkbox-${t.id}`,className:"flex-grow pointer-events-none",children:t.name}),r&&e.jsx(H,{className:"h-4 w-4 ml-auto"})]});return r?e.jsxs(w,{children:[e.jsx(b,{asChild:!0,children:e.jsx(I,{onSelect:x=>x.preventDefault(),className:"justify-between",children:h})}),e.jsx(Y,{children:e.jsx(C,{align:n,sideOffset:8,alignOffset:-5,children:e.jsx(J,{levelItems:t.children||[],selectedIds:a,onBatchChange:c})})})]}):e.jsx(I,{onSelect:x=>x.preventDefault(),children:h})},J=({levelItems:t,selectedIds:a,onBatchChange:c,align:n})=>{const u=f.useRef(null),r=k(),i=f.useMemo(()=>t.flatMap(o=>o.asGroupLabel?void 0:[o.id,...$(o)]).filter(o=>o!==void 0),[t]),h=f.useMemo(()=>i.filter(o=>a.has(o)).length,[i,a]),x=h===i.length&&i.length>0,p=h>0&&h<i.length;f.useEffect(()=>{u.current&&u.current.setAttribute("data-state",p?"indeterminate":x?"checked":"unchecked")},[p,x]);const j=()=>{c(i,!x)};return e.jsxs(e.Fragment,{children:[e.jsx(I,{onSelect:o=>o.preventDefault(),onClick:j,children:e.jsxs("div",{className:"flex items-center w-full cursor-pointer",children:[e.jsx(U,{checked:p?"indeterminate":x||p,id:`select-all-${t[0]?.id}`,className:"mr-2 pointer-events-none"}),e.jsx("label",{htmlFor:`select-all-${t[0]?.id}`,className:"w-full pointer-events-none",children:r("select-all")})]})}),e.jsx(Z,{}),t.map(o=>o.asGroupLabel?e.jsx(_,{children:o.asGroupLabel},o.id):e.jsx(de,{align:n,item:o,selectedIds:a,onBatchChange:c},o.id))]})},oe=({list:t,value:a,onValueChange:c,trigger:n,align:u})=>{const r=f.useMemo(()=>new Set(a),[a]),i=(h,x)=>{const p=new Set(r);x?h.forEach(j=>p.add(j)):h.forEach(j=>p.delete(j)),c(Array.from(p))};return e.jsxs(w,{children:[e.jsx(b,{asChild:!0,children:n||e.jsx(v,{variant:"outline",children:"Please select"})}),e.jsx(Y,{children:e.jsx(C,{align:u,className:"w-48",children:e.jsx(J,{align:u,levelItems:t,selectedIds:r,onBatchChange:i})})})]})},K=({visible:t,onClear:a,children:c,className:n})=>e.jsxs("div",{className:B("flex items-center",n),children:[c,t&&e.jsx("button",{type:"button",className:B("flex items-center rounded-full justify-center hover:bg-accent hover:text-accent-foreground"),onClick:a,children:e.jsx("i",{className:"icon-[mdi--close] opacity-80 size-4"})})]});function ue({form:t,setForm:a,className:c}){const n=k(),u=t.recent===void 0?"date":"recent",r=()=>{},i=ee(),{incomes:h,expenses:x,categories:p}=se(),j=f.useMemo(()=>[{id:"ExpensesLabel",asGroupLabel:n("expense"),name:""},...x,{id:"IncomesLabel",asGroupLabel:n("income"),name:""},...h],[x,h,n]),o=p.filter(s=>t.type===void 0?!0:s.type===t.type).reduce((s,l)=>{const d=s.find(m=>m.type===l.type);return d?(d.list.push(l),s):(s.push({type:l.type,list:[l]}),s)},[]),g=s=>s===void 0||s.length===0?n("unlimited"):s.length===o.reduce((l,d)=>l+d.list.length,0)?n("all"):s.map(l=>p.find(d=>d.id===l)?.name??l).join(","),M=s=>s===void 0||s.length===0?n("unlimited"):s.length===i.length?n("all"):s.map(l=>i.find(d=>d.id===l)?.name??l).join(","),{tags:S}=te(),E=s=>s===void 0||s.length===0?n("unlimited"):s.map(l=>S.find(d=>d.id===l)?.name??l).join(","),{allCurrencies:G}=L(),Q=s=>s===void 0||s.length===0?n("unlimited"):s.map(l=>G.find(d=>d.id===l).label).join(",");return e.jsxs("div",{className:B("flex flex-col gap-3 border-b",c),children:[e.jsxs("div",{className:"flex justify-between items-center gap-2",children:[e.jsxs(F,{value:u,onValueChange:s=>{if(s==="recent"){a(l=>({...l,recent:{value:1,unit:"month"}}));return}a(l=>({...l,recent:void 0}))},children:[e.jsx(P,{className:"w-fit px-2 py-2 md:px-4 text-xs md:text-sm",children:e.jsx(R,{})}),e.jsxs(V,{children:[e.jsx(N,{value:"date",children:n("as-date")}),e.jsx(N,{value:"recent",children:n("recent")})]})]}),u==="date"?e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(O,{value:t.start,type:"start",onChange:s=>a(l=>({...l,start:s})),onBlur:r}),e.jsx("div",{className:"px-1",children:" - "}),e.jsx(O,{value:t.end,type:"end",onChange:s=>a(l=>({...l,end:s})),onBlur:r})]}):e.jsxs("div",{className:"flex justify-between items-center gap-2",children:[e.jsx(A,{value:t.recent?.value,onChange:s=>{s!==void 0&&a(l=>({...l,recent:{unit:l.recent?.unit??"week",value:s}}))}}),e.jsxs(F,{value:t.recent?.unit??"day",onValueChange:s=>{a(l=>({...l,recent:{value:l.recent?.value??1,unit:s}}))},children:[e.jsx(P,{className:"w-20 px-2 py-2 md:px-4 text-xs md:text-sm",children:e.jsx(R,{})}),e.jsxs(V,{children:[e.jsx(N,{value:"day",children:n("unit-day")}),e.jsx(N,{value:"week",children:n("unit-week")}),e.jsx(N,{value:"month",children:n("month")}),e.jsx(N,{value:"year",children:n("year")})]})]})]})]}),e.jsxs("div",{className:"w-full flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"icon-[mdi--arrow-collapse]"}),n("type"),":"]}),e.jsxs("div",{className:"flex items-center rounded-md shadow border border-input overflow-hidden divide-x",children:[e.jsx("button",{type:"button",className:`w-20 flex items-center justify-center pr-2 md:pl-4 py-2 h-[34px] buttoned cursor-pointer transition-colors duration-200 ${t.type==="income"?"!bg-stone-700 !text-white":""}`,onClick:()=>a(s=>({...s,type:"income"})),children:n("income")}),e.jsx("button",{type:"button",className:`w-20 flex items-center justify-center py-2 h-[34px] buttoned cursor-pointer transition-colors duration-200 ${t.type==="expense"?"!bg-stone-700 !text-white":""}`,onClick:()=>a(s=>({...s,type:"expense"})),children:n("expense")}),e.jsx("button",{type:"button",className:`w-20 flex items-center justify-center pr-2 md:pr-4 py-2 h-[34px] buttoned cursor-pointer transition-colors duration-200 ${t.type===void 0?"!bg-stone-700 !text-white":""}`,onClick:()=>a(s=>({...s,type:void 0})),children:n("all")})]})]}),e.jsxs("div",{className:"w-full flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"icon-[mdi--scale-unbalanced]"}),n("amount"),":"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(A,{value:t.minAmountNumber,onChange:s=>a(l=>({...l,minAmountNumber:s})),onBlur:r}),e.jsx("div",{children:" - "}),e.jsx(A,{value:t.maxAmountNumber,onChange:s=>a(l=>({...l,maxAmountNumber:s})),onBlur:r})]})]}),e.jsxs("div",{className:"w-full flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"icon-[mdi--category-plus-outline]"}),n("categories"),":"]}),e.jsx(oe,{value:t.categories??p.map(s=>s.id),list:j,align:"end",trigger:e.jsx(v,{variant:"outline",className:"px-2 md:px-4 py-2 text-xs md:text-sm",children:e.jsx("div",{className:"truncate max-w-[200px]",children:g(t.categories)})}),onValueChange:s=>{a(l=>({...l,categories:s}))}})]}),e.jsxs("div",{className:"w-full flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"icon-[mdi--currency-eur]"}),n("currency"),":"]}),e.jsxs(w,{children:[e.jsx(b,{asChild:!0,children:e.jsx(v,{variant:"outline",className:"px-2 md:px-4 py-2 text-xs md:text-sm",children:e.jsx("div",{className:"max-w-[120px] truncate",children:Q(t.currencies)})})}),e.jsx(C,{className:"w-56",align:"end",children:G.map(s=>e.jsx(D,{checked:t.currencies?t.currencies.includes(s.id):!1,onCheckedChange:l=>{a(d=>{const m=new Set(d.currencies??[]);l?m.add(s.id):m.delete(s.id);const y=Array.from(m);return{...d,currencies:y}})},children:s.label},s.id))})]})]}),e.jsxs("div",{className:"w-full flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"icon-[mdi--user-details-outline]"}),n("users"),":"]}),e.jsxs(w,{children:[e.jsx(b,{asChild:!0,children:e.jsx(v,{variant:"outline",className:"px-2 md:px-4 py-2 text-xs md:text-sm",children:e.jsx("div",{className:"max-w-[120px] truncate",children:M(t.creators)})})}),e.jsx(C,{className:"w-56",align:"end",children:i.map(s=>e.jsx(D,{checked:t.creators?t.creators.includes(s.id):!0,onCheckedChange:l=>{a(d=>{const m=new Set(d.creators??i.map(T=>T.id));l?m.add(s.id):m.delete(s.id);const y=m.size===0?d.creators:Array.from(m);return{...d,creators:y}})},children:s.name},s.id))})]})]}),e.jsxs("div",{className:"w-full flex justify-between items-center gap-2 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx("i",{className:"icon-[mdi--tag-outline]"}),n("tags"),":"]}),e.jsxs("div",{className:"flex items-center gap-4 overflow-y-auto scrollbar-hidden",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-shrink-0",children:n("tags-excluded-short")}),e.jsxs(w,{children:[e.jsx(b,{asChild:!0,children:e.jsx(v,{variant:"outline",className:"px-2 md:px-4 py-2 text-xs md:text-sm",children:e.jsx("div",{className:"max-w-[120px] truncate",children:E(t.excludeTags)})})}),e.jsx(C,{className:"w-56",align:"end",children:S.map(s=>e.jsx(D,{checked:t.excludeTags?.includes(s.id),onCheckedChange:l=>{a(d=>{const m=new Set(d.excludeTags??[]);l?m.add(s.id):m.delete(s.id);const y=Array.from(m);return{...d,excludeTags:y}})},children:s.name},s.id))})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-shrink-0",children:n("tags-include-short")}),e.jsxs(w,{children:[e.jsx(b,{asChild:!0,children:e.jsx(v,{variant:"outline",className:"px-2 md:px-4 py-2 text-xs md:text-sm",children:e.jsx("div",{className:"max-w-[120px] truncate",children:E(t.tags)})})}),e.jsx(C,{className:"w-56",align:"end",children:S.map(s=>e.jsx(D,{checked:t.tags?t.tags.includes(s.id):!0,onCheckedChange:l=>{a(d=>{const m=new Set(d.tags??S.map(T=>T.id));l?m.add(s.id):m.delete(s.id);const y=Array.from(m);return{...d,tags:y}})},children:s.name},s.id))})]})]})]})]}),e.jsxs("div",{className:"w-full flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"icon-[mdi--archive-outline]"}),n("others"),":"]}),e.jsx("div",{className:"flex-1 flex justify-end overflow-y-scroll gap-3 py-1",children:e.jsx(ne,{checked:t.assets,onCheckedChange:s=>{a(l=>({...l,assets:s}))},className:"text-xs bg-transparent shadow-md",children:n("with-assets")})})]}),e.jsx("div",{className:"h-2"})]})}function A({value:t,onChange:a,onBlur:c}){const n=k();return e.jsxs(K,{visible:!0,className:"relative rounded-md shadow px-2 py-2 md:px-4 border border-input truncate cursor-pointer hover:text-accent-foreground group range-input",onClear:()=>a?.(void 0),children:[t===void 0&&e.jsx("span",{className:"absolute pointer-events-none group-[.range-input:focus-within]:hidden pr-4",children:n("unlimited")}),e.jsx("input",{type:"number",className:"max-w-[64px] h-[18px] bg-transparent outline-none text-right",value:t??"",onChange:u=>{a?.(Number(u.target.value))},onBlur:c})]})}function O({value:t,onChange:a,onBlur:c,type:n}){const u=k();return e.jsx(K,{visible:!0,className:"rounded-md shadow px-2 py-2 md:px-4 border border-input truncate cursor-pointer hover:text-accent-foreground",onClear:()=>a?.(void 0),children:e.jsx(le,{value:t,displayFormatter:r=>r===void 0?u(n==="start"?"from-oldest":"to-newest"):`${r.format("YY/MM/DD")}`,onChange:r=>a?.(r),onBlur:c})})}function xe({edit:t,onCancel:a,onConfirm:c}){const{baseCurrency:n}=L(),[u,r]=f.useState(t?.filter??{baseCurrency:n.id}),[i,h]=f.useState(t?.name??""),[x,p]=f.useState(t?.displayCurrency??ae),j=k(),{quickCurrencies:o}=L();return e.jsxs("div",{className:"flex flex-col p-2 gap-2 h-[55vh] overflow-hidden",children:[e.jsxs("label",{className:"outline rounded px-4 py-1 w-fit",children:[e.jsx("input",{className:"w-min outline-none font-semibold text-lg",value:i,onChange:g=>{h(g.currentTarget.value)}}),e.jsx("i",{className:"icon-[mdi--edit-outline]"})]}),e.jsxs("div",{className:"flex-1 px-2 overflow-y-auto",children:[e.jsx(ue,{form:u,setForm:r,className:"text-xs md:text-sm border-none"}),e.jsx("div",{className:"text-xs opacity-60 pb-2",children:j("stat-view-settings")}),e.jsxs("div",{className:"text-xs md:text-sm flex justify-between items-center",children:[e.jsx("div",{children:e.jsxs(re,{children:[e.jsx(ie,{children:e.jsxs("div",{className:"flex gap-1 items-center",children:[e.jsx("div",{children:j("display-currency")}),e.jsx("i",{className:"icon-[mdi--question-mark-circle-outline]"})]})}),e.jsx(ce,{side:"bottom",className:"p-1",children:e.jsx("div",{className:"text-xs opacity-60",children:j("display-currency-desc")})})]})}),e.jsxs(F,{value:x,onValueChange:p,children:[e.jsx(P,{children:e.jsx("div",{children:o.find(g=>g.id===x)?.label??j("base-currency")})}),e.jsx(V,{children:o.length>0?o.map(({id:g,label:M})=>e.jsx(N,{value:g,children:e.jsx("div",{children:M})},g)):e.jsx("div",{className:"text-sm opacity-60",children:j("empty-currency-quick-entries")})})]})]})]}),e.jsxs("div",{className:"w-full px-4 flex justify-between gap-2",children:[e.jsx("div",{children:!t?.hideDelete&&e.jsx(v,{variant:"destructive",onClick:()=>{confirm(j("are-you-sure-to-delete-this-filter"))&&c?.("delete")},children:j("delete")})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{variant:"ghost",onClick:()=>a?.(),children:j("cancel")}),e.jsx(v,{onClick:()=>c?.({filter:u,name:i||void 0,displayCurrency:x}),children:j("confirm")})]})]})]})}const he=W(xe,{dialogTitle:"Edit Bill Filter",fade:!0,swipe:!1,contentClassName:"overflow-hidden"}),[fe,ge]=he;function ve(){const t=f.useCallback(async(c,n)=>{if(!q.getState().currentBookId)return;const r=X();return await z.getState().updateGlobalMeta(i=>(i.customFilters===void 0&&(i.customFilters=[]),i.customFilters.push({id:r,...n,name:c}),i)),r},[]),a=f.useCallback(async(c,n)=>{q.getState().currentBookId&&await z.getState().updateGlobalMeta(r=>{if(r.customFilters===void 0)return r;if(n===void 0)return r.customFilters=r.customFilters.filter(h=>h.id!==c),r;const i=r.customFilters.findIndex(h=>h.id===c);return i===-1||(r.customFilters[i]={...r.customFilters[i],...n,name:n.name??r.customFilters[i],filter:n.filter}),r})},[]);return{addFilter:t,updateFilter:a}}export{fe as B,K as C,O as D,ue as a,ge as s,ve as u};
